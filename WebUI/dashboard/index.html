<!DOCTYPE html>
<html>
<head>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<link rel="icon" href="/favicon.ico" type="image/x-icon">
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"> --> 
 <link rel="stylesheet" href="https://bootswatch.com/spacelab/bootstrap.min.css">


 
<title>Dashboard</title>

<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.1.2/firebase.js"></script>
<script src="/socket.io/socket.io.js"></script> 
<script type="text/javascript">
	
	var config = {
    apiKey: "AIzaSyA_yDgR6Ru2hVlCPT86y1FKH2Jx2HI0PGc",
    authDomain: "phonefindr-39f72.firebaseapp.com",
    databaseURL: "https://phonefindr-39f72.firebaseio.com",
    projectId: "phonefindr-39f72",
    storageBucket: "phonefindr-39f72.appspot.com",
    messagingSenderId: "753747182589"
  };
  firebase.initializeApp(config);

  var email, socket;

  firebase.auth().onAuthStateChanged(function(user) {
  
  if (user) {
  	email = user.email;
// <<<<<<< WebUI
//drew2g 6/23 ===============================
//emit the 'new user' socket.on method in index.js, using this function to pass the email address and another function as a callback
//===========================================
    socket.emit('new user', email ,function(data){

              if(data){
              localStorage.email = email; //t
            }
          })


    $('#userDiv').html('Hello, \n' + email);
    $('#userDiv').css('color','white');

// =======

   
// >>>>>>> master
    
      
  } 
  else{
  	window.location.href = "/";
  }

});

  function logOut(){
  	firebase.auth().signOut().then(function() {
  		window.location.href = "/";
	}).catch(function(error) {
 		 // An error happened.
	});


  }

</script>

<script type="text/javascript">

    var socket = io.connect();
    

    socket.on('new user', function(data, callback){
    if(users.indexOf(data) != -1){
      callback(false);
      return;
    }
      
      /* temp this will go on the Android side*/
      socket.on('ring request', function(data){
   			$('#tempDiv').html('PHONE RING REQUESTED');
				
				
			});
    
    callback(true);
    socket.username = data;
    users.push(socket.username);
  });

  function makeRing(){
  	socket.emit('ring', email);

  }


$(document).ready(function() {
    $(".dropdown-toggle").dropdown();
});


</script>


</head>
  <header style="height:4.5em;background-color:grey;">
  <div id ="topBar" style="float:right">
      <div id="userDiv">
      </div>
      <button onclick="logOut()" class="btn btn-default">Log Out</button>
      <button onclick="makeRing()" class="btn btn-default">Make it Ring</button>
      <div id="tempDiv" style="font-weight: bold; color:red; font-size: 24px;">
      </div>
    </div>
  </header>
<body>
  <h1 style="clear:both;text-align:center;margin:.4em;">Android Phone Finder</h1>
</body>
</html>